<!DOCTYPE html>


<html lang="en-us" data-theme="">
<head>
    
        
<meta charset="utf-8">
<meta name="HandheldFriendly" content="True">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer-when-downgrade">

<title>How to use a Raspberry as Time Capsule (MacOS) - Toni&#39;s Blog</title>

<meta name="description" content="Let&rsquo;s emulate a Time Capsule! ðŸš€">



<link rel="icon" type="image/x-icon" href="https://czyrnik.me/favicon.ico">
<link rel="apple-touch-icon-precomposed" href="https://czyrnik.me/favicon.png">



    





    
    
        
    
    

    
        <link rel="stylesheet" href="https://czyrnik.me/css/style.min.a11b8916e7fc33d397d735329bc39b452eba5901a3c1a497fadc20be86f83e54.css" integrity="sha256-oRuJFuf8M9OX1zUym8ObRS66WQGjwaSX&#43;twgvob4PlQ=">
    






<meta property="og:title" content="How to use a Raspberry as Time Capsule (MacOS)" />
<meta property="og:description" content="Let&rsquo;s emulate a Time Capsule! ðŸš€" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://czyrnik.me/blog/how-to-set-a-raspberry-as-time-capsule/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2022-04-09T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-04-09T00:00:00+00:00" />


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="How to use a Raspberry as Time Capsule (MacOS)"/>
<meta name="twitter:description" content="Let&rsquo;s emulate a Time Capsule! ðŸš€"/>











    
</head>
<body>
    <a class="skip-main" href="#main">Skip to main content</a>
    <div class="container">
        <header class="common-header"> 
            
                <div class="header-top">
    <h1 class="site-title">
        <a href="/">Toni&#39;s Blog</a>
    </h1>
    <ul class="social-icons">


    
        <li>
            <a href="https://www.linkedin.com/in/czyrnik/" title="Linkedin" rel="me">
            <span class="inline-svg" >




    
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>

</span>

            </a>
        </li>
    

    
        <li>
            <a href="https://github.com/ToniCzyrnik/ToniCzyrnik.github.io" title="Github" rel="me">
            <span class="inline-svg" >




    
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

</span>

            </a>
        </li>
    

    
        <li>
            <a href="mailto:mail@czyrnik.me" title="Email" rel="me">
            <span class="inline-svg" >




    
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M464 64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm0 48v40.805c-22.422 18.259-58.168 46.651-134.587 106.49-16.841 13.247-50.201 45.072-73.413 44.701-23.208.375-56.579-31.459-73.413-44.701C106.18 199.465 70.425 171.067 48 152.805V112h416zM48 400V214.398c22.914 18.251 55.409 43.862 104.938 82.646 21.857 17.205 60.134 55.186 103.062 54.955 42.717.231 80.509-37.199 103.053-54.947 49.528-38.783 82.032-64.401 104.947-82.653V400H48z"/></svg>

</span>

            </a>
        </li>
    

</ul>

</div>

    <nav>
        
        
        <a class="" href="https://czyrnik.me/blog/" title="">Blog</a>
        
        <a class="" href="https://czyrnik.me/newsletter/sign_up" title="">Newsletter</a>
        
        <a class="" href="https://czyrnik.me/about/" title="">About</a>
        
    </nav>




            
        </header>
        <main id="main" tabindex="-1"> 
            
    

    <article class="post h-entry">
        <div class="post-header">
            <header>
                <h1 class="p-name post-title">How to use a Raspberry as Time Capsule (MacOS)</h1>

                
            </header>
        </div>
        <div class="content e-content">
            <h2 id="setup-raspberry-pi">Setup Raspberry Pi
<span><a href="#setup-raspberry-pi">#</a></span>
</h2><p>If you want to read about our basic Raspberry Setup: <a href="https://czyrnik.me/blog/how-to-set-up-a-raspberry-pi/">Here you go!</a></p>
<h2 id="prepare-the-external-drive">Prepare the external drive
<span><a href="#prepare-the-external-drive">#</a></span>
</h2><p>The most important thing is going to be our connected hard drive. I used a SSD connected via USB to the Pi. We need a drive that uses HFS+ or APFS. Otherwise, we cannot use it for Time Machine. Currently, there&rsquo;s only a reliable read-only version for APFS on Linux. So, we are going to use HFS+ instead.</p>
<p>Please make sure you format your drive correctly and do not forget to give read and write permissions to everyone using &ldquo;get info&rdquo; on your Mac.</p>
<p><img src="./permissions.png" alt="Permissions"></p>
<h2 id="mounting-our-hard-drive">Mounting our Hard Drive
<span><a href="#mounting-our-hard-drive">#</a></span>
</h2><p>After we connected your drive to the Pi, we need to mount it. Otherwise we cannot access it. The Format HFS+ is not native to Linux. So, we need to install it.</p>
<pre><code>sudo apt-get install hfsprogs
</code></pre>
<p>After installing it, we need to find the name of our drive.</p>
<pre><code>lsblk -f
</code></pre>
<p>The name of my drive is &ldquo;sda2&rdquo;. You&rsquo;ll find yours looking at the format and the size.</p>
<h3 id="creating-a-mount-point">Creating a Mount Point
<span><a href="#creating-a-mount-point">#</a></span>
</h3><p>Before mounting a drive, we&rsquo;ll need a mount point! Let&rsquo;s create a directory. You can choose the path to your point as you like. I chose &ldquo;/TM&rdquo;</p>
<pre><code>sudo mkdir -p /TM
</code></pre>
<p>Let&rsquo;s mount our drive!</p>
<pre><code>sudo mount -t hfsplus -o force,rw /dev/name_of_your_drive /your_mount_point
</code></pre>
<p>Unfortunately, the drive is not yet mounted permantly. Let&rsquo;s do that! Let&rsquo;s find the &ldquo;PARTUUID&rdquo; of your drive fist.</p>
<pre><code>sudo blkid /dev/sda2
</code></pre>
<p>Let&rsquo;s open the following:</p>
<pre><code>sudo nano /etc/fstab
</code></pre>
<p>Add this line with your &ldquo;PARTUUID&rdquo; to the bottom of the file.</p>
<pre><code>PARTUUID=&quot;your_partuuid&quot; /your_mountpoint     hfsplus force,rw,user,auto        0       0
</code></pre>
<p>Now, our drive will be mounted after every boot of the pi! ðŸ¤¯</p>
<h2 id="preparing-everything-for-time-machine">Preparing everything for Time Machine
<span><a href="#preparing-everything-for-time-machine">#</a></span>
</h2><p>Before the can access the drive from our Mac, we need couple of additional tweaks.</p>
<h3 id="install-samba-and-avahi">Install Samba and Avahi
<span><a href="#install-samba-and-avahi">#</a></span>
</h3><p>Samba is used for the file server.</p>
<p>Avahi emulates a Time Capsule and our drive get&rsquo;s automatically discovered by MacOS. ðŸ”Ž</p>
<p>Let&rsquo;s install everything on our Raspberry Pi.</p>
<pre><code>sudo apt-get install samba avahi-daemon
</code></pre>
<h3 id="creating-a-new-user-on-the-pi">Creating a new user on the Pi
<span><a href="#creating-a-new-user-on-the-pi">#</a></span>
</h3><p>Let&rsquo;s add a user &ldquo;timemachine&rdquo; for dealing with all our Time Machine stuff!</p>
<pre><code>sudo adduser timemachine
</code></pre>
<p>After creating the user, you&rsquo;ll be prompted to enter a password for the new user on your Raspberry Pi.</p>
<h3 id="configurating-samba">Configurating Samba
<span><a href="#configurating-samba">#</a></span>
</h3><p>We need to define a password for Samba. I used the same password for convenience.</p>
<pre><code>sudo smbpasswd -a timemachine
</code></pre>
<p>The need to define same details for Samba. &ldquo;Time Machine&rdquo; will be the name for our server.</p>
<pre><code>sudo nano /etc/samba/smb.conf
</code></pre>
<p>Add these lines to end of the file:</p>
<pre><code>[Time Machine]
	comment = Backups
	path = /your_mount_point
	valid users = timemachine
	read only = no
	vfs objects = catia fruit streams_xattr
	fruit:time machine = yes
</code></pre>
<p>The changes will be affective after reloading Samba!</p>
<pre><code>sudo service smbd reload
</code></pre>
<h3 id="configurating-avahi">Configurating Avahi
<span><a href="#configurating-avahi">#</a></span>
</h3><p>Allmost done! ðŸ™‚</p>
<p>We need to configure Avahi. Lets open the following file:</p>
<pre><code>sudo nano /etc/avahi/services/samba.service
</code></pre>
<p>The need to copy all the following into this file:</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; standalone='no'?&gt;&lt;!--*-nxml-*--&gt;
&lt;!DOCTYPE service-group SYSTEM &quot;avahi-service.dtd&quot;&gt;
&lt;service-group&gt;
  &lt;name replace-wildcards=&quot;yes&quot;&gt;%h&lt;/name&gt;
  &lt;service&gt;
    &lt;type&gt;_smb._tcp&lt;/type&gt;
    &lt;port&gt;445&lt;/port&gt;
  &lt;/service&gt;
  &lt;service&gt;
    &lt;type&gt;_device-info._tcp&lt;/type&gt;
    &lt;port&gt;9&lt;/port&gt;
    &lt;txt-record&gt;model=TimeCapsule8,119&lt;/txt-record&gt;
  &lt;/service&gt;
  &lt;service&gt;
    &lt;type&gt;_adisk._tcp&lt;/type&gt;
    &lt;port&gt;9&lt;/port&gt;
    &lt;txt-record&gt;dk0=adVN=Time Machine,adVF=0x82&lt;/txt-record&gt;
    &lt;txt-record&gt;sys=adVF=0x100&lt;/txt-record&gt;
  &lt;/service&gt;
&lt;/service-group&gt;
</code></pre>
<p>Let&rsquo;s reload the service, so the changes will be affective:</p>
<pre><code>sudo service avahi-daemon reload
</code></pre>
<p>Now, your raspberry should be recognized as a Time Capsule!</p>
<p><img src="./time_capsule.png" alt="Show what you got!"></p>
<p>Time Machine, here I come! ðŸš€</p>
<h2 id="optional-read-only-and-backup-the-pi">Optional: Read only and Backup the Pi
<span><a href="#optional-read-only-and-backup-the-pi">#</a></span>
</h2><h3 id="read-only">Read only
<span><a href="#read-only">#</a></span>
</h3><p>You can make your Raspberry Pi read only, so nothing can be changed. That should increase your reliability of the system and the longevity of your SD card. The lifetime of SD cards are mainly dependent on the write cycles they endure.</p>
<p>You will find the setting here:</p>
<pre><code>sudo raspi-config
</code></pre>
<p>Go to &ldquo;Performance Options&rdquo; and &ldquo;Overlay File System&rdquo;.</p>
<h3 id="backup">Backup
<span><a href="#backup">#</a></span>
</h3><p>The most simple way to backup your Pi is just to copy all the files on the SD card. You could store the files on your Mac.</p>
<h2 id="conclusion">Conclusion
<span><a href="#conclusion">#</a></span>
</h2><p>We&rsquo;ve seen how to emulate a Time Capsule using a Raspberry Pi. Due to the small size of the Raspberry Pi, it&rsquo;s a very portable backup solution, which can be taken everywhere!</p>

        </div>
        

    


<div class="post-info">
    
        <div class="post-date dt-published">2022-04-09</div>
    

    <a class="post-hidden-url u-url" href="https://czyrnik.me/blog/how-to-set-a-raspberry-as-time-capsule/">https://czyrnik.me/blog/how-to-set-a-raspberry-as-time-capsule/</a>
    <a href="https://czyrnik.me" class="p-name p-author post-hidden-author h-card" rel="me">Toni Czyrnik</a>


    <div class="post-taxonomies">
        
            <ul class="post-categories">
                
                    
                    <li><a href="">Raspberry Pi</a></li>
                
                    
                    <li><a href="https://czyrnik.me/categories/coding/">Coding</a></li>
                
            </ul>
            
            
    </div>
</div>

    </article>

    
        
    <div class="pagination post-pagination">
        <div class="left pagination-item ">
            
                <a href="/blog/how-to-set-up-a-raspberry-pi/">How to set up a Raspberry Pi</a>
            
        </div>
        <div class="right pagination-item ">
            
                <a href="/blog/tallinn-as-digital-nomad/">Tallinn as Digital Nomad</a>
            
        </div>
    </div>




    

    

    

    


        </main>
        
            <footer class="common-footer">
    
    

    <div class="common-footer-bottom">
        
        <div class="copyright">
            <p>Â© Toni Czyrnik, 2022<br>
            Powered by <a target="_blank" rel="noopener noreferrer" href="https://gohugo.io/">Hugo</a>, theme <a target="_blank" rel="noopener noreferrer" href="https://github.com/mitrichius/hugo-theme-anubis">Anubis</a>.<br>
            
            </p>  
        </div> 

        

    



    <button class="theme-switcher">
        Dark theme
    </button>

    <script>
    const STORAGE_KEY = 'user-color-scheme'
    const defaultTheme = "auto"

    let currentTheme
    let switchButton
    let autoDefinedScheme = window.matchMedia('(prefers-color-scheme: dark)')

    const autoChangeScheme = e => {
        currentTheme = e.matches ? 'dark' : 'light'
        document.documentElement.setAttribute('data-theme', currentTheme)
        changeButtonText()
    }

    document.addEventListener('DOMContentLoaded', function() {
        switchButton = document.querySelector('.theme-switcher')
        currentTheme = detectCurrentScheme()
        if (currentTheme == 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark')
        }
        if (currentTheme == 'auto') {
            autoChangeScheme(autoDefinedScheme);
            autoDefinedScheme.addListener(autoChangeScheme);
        }
        changeButtonText()
        switchButton.addEventListener('click', switchTheme, false)
    })

    function detectCurrentScheme() {
        if (localStorage.getItem(STORAGE_KEY)) {
            return localStorage.getItem(STORAGE_KEY)
        } 
        if (defaultTheme) {
            return defaultTheme
        } 
        if (!window.matchMedia) {
            return 'light'
        } 
        if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
            return 'dark'
        }
        return 'light'
    }

    function changeButtonText()
    {   
        switchButton.textContent = currentTheme == 'dark' ?  "Light theme" : "Dark theme"
    }

    function switchTheme(e) {
        if (currentTheme == 'dark') {
            localStorage.setItem(STORAGE_KEY, 'light')
            document.documentElement.setAttribute('data-theme', 'light')
            currentTheme = 'light'
        } else {
            localStorage.setItem(STORAGE_KEY, 'dark')
            document.documentElement.setAttribute('data-theme', 'dark')
            currentTheme = 'dark'
        }
        changeButtonText()
    }
    </script>
   
    </div>

    <p class="h-card vcard">

    <a href=https://czyrnik.me class="p-name u-url url fn" rel="me">Toni Czyrnik</a> 

    

    
</p> 
</footer>

        
    </div>
</body>
</html>
