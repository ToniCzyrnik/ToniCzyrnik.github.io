<!DOCTYPE html>


<html lang="en-us" data-theme="">
<head>
    
        
<meta charset="utf-8">
<meta name="HandheldFriendly" content="True">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer-when-downgrade">

<title>How to Configure a Raspberry Pi - Toni&#39;s Blog</title>

<meta name="description" content="Configuration of your Raspberry Pi: Passwordless SSH Access, Wireless Access Point, Backup and Restoring the SD Card 🤓">



<link rel="icon" type="image/x-icon" href="https://czyrnik.me/favicon.ico">
<link rel="apple-touch-icon-precomposed" href="https://czyrnik.me/favicon.png">



    





    
    
        
    
    

    
        <link rel="stylesheet" href="https://czyrnik.me/css/style.min.a11b8916e7fc33d397d735329bc39b452eba5901a3c1a497fadc20be86f83e54.css" integrity="sha256-oRuJFuf8M9OX1zUym8ObRS66WQGjwaSX&#43;twgvob4PlQ=">
    






<meta property="og:title" content="How to Configure a Raspberry Pi" />
<meta property="og:description" content="Configuration of your Raspberry Pi: Passwordless SSH Access, Wireless Access Point, Backup and Restoring the SD Card 🤓" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://czyrnik.me/blog/how-to-configure-a-raspberry-pi/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2022-04-10T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-04-10T00:00:00+00:00" />


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="How to Configure a Raspberry Pi"/>
<meta name="twitter:description" content="Configuration of your Raspberry Pi: Passwordless SSH Access, Wireless Access Point, Backup and Restoring the SD Card 🤓"/>











    
</head>
<body>
    <a class="skip-main" href="#main">Skip to main content</a>
    <div class="container">
        <header class="common-header"> 
            
                <div class="header-top">
    <h1 class="site-title">
        <a href="/">Toni&#39;s Blog</a>
    </h1>
    <ul class="social-icons">


    
        <li>
            <a href="https://www.linkedin.com/in/czyrnik/" title="Linkedin" rel="me">
            <span class="inline-svg" >




    
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>

</span>

            </a>
        </li>
    

    
        <li>
            <a href="https://github.com/ToniCzyrnik/ToniCzyrnik.github.io" title="Github" rel="me">
            <span class="inline-svg" >




    
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

</span>

            </a>
        </li>
    

    
        <li>
            <a href="mailto:mail@czyrnik.me" title="Email" rel="me">
            <span class="inline-svg" >




    
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M464 64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm0 48v40.805c-22.422 18.259-58.168 46.651-134.587 106.49-16.841 13.247-50.201 45.072-73.413 44.701-23.208.375-56.579-31.459-73.413-44.701C106.18 199.465 70.425 171.067 48 152.805V112h416zM48 400V214.398c22.914 18.251 55.409 43.862 104.938 82.646 21.857 17.205 60.134 55.186 103.062 54.955 42.717.231 80.509-37.199 103.053-54.947 49.528-38.783 82.032-64.401 104.947-82.653V400H48z"/></svg>

</span>

            </a>
        </li>
    

</ul>

</div>

    <nav>
        
        
        <a class="" href="https://czyrnik.me/blog/" title="">Blog</a>
        
        <a class="" href="https://czyrnik.me/newsletter/signup" title="">Newsletter</a>
        
        <a class="" href="https://czyrnik.me/about/me" title="">About</a>
        
    </nav>




            
        </header>
        <main id="main" tabindex="-1"> 
            
    

    <article class="post h-entry">
        <div class="post-header">
            <header>
                <h1 class="p-name post-title">How to Configure a Raspberry Pi</h1>

                
            </header>
        </div>
        <div class="content e-content">
            <p>We will secure your Raspberry Pi, create a wireless access point and learn how backup the SD Card of the Raspberry Pi. 🤓</p>
<h2 id="securing-your-raspberry-pi">Securing your Raspberry Pi
<span><a href="#securing-your-raspberry-pi">#</a></span>
</h2><p>Please make sure, that your Overlay File System is deactivated and the boot partition writable.</p>
<pre><code>sudo raspi-config
</code></pre>
<p>After you deactivated the Overlay File System, please reboot.</p>
<pre><code>sudo reboot
</code></pre>
<h3 id="passwordless-ssh-access">Passwordless SSH Access
<span><a href="#passwordless-ssh-access">#</a></span>
</h3><p>Please check, whether you have already created SSH Keys in the past. If there are files like &ldquo;id_rsa.pub&rdquo; or &ldquo;id_dsa.pub&rdquo;, you don&rsquo;t need to generate new keys.</p>
<pre><code>ls ~/.ssh
</code></pre>
<h4 id="generate-new-ssh-keys">Generate new SSH Keys
<span><a href="#generate-new-ssh-keys">#</a></span>
</h4><p>You can generate the keys with or without a passphrase using:</p>
<pre><code>ssh-keygen
</code></pre>
<p>You check them with this line:</p>
<pre><code>cat ~/.ssh/id_rsa.pub
</code></pre>
<h4 id="copy-the-key-to-the-raspberry-pi">Copy the Key to the Raspberry Pi
<span><a href="#copy-the-key-to-the-raspberry-pi">#</a></span>
</h4><p>Now, you can transfer your Key to the Raspberry Pi using ssh.</p>
<pre><code>ssh-copy-id &lt;USERNAME&gt;@&lt;IP-ADDRESS&gt;
</code></pre>
<h4 id="storing-the-passphrase-in-the-macos-keychain">Storing the passphrase in the macOS keychain
<span><a href="#storing-the-passphrase-in-the-macos-keychain">#</a></span>
</h4><p>You can store your passphrase in the macOS keychain using:</p>
<pre><code>ssh-add --apple-use-keychain ~/.ssh/id_rsa
</code></pre>
<h4 id="allow-and-deny-ssh-access">Allow and Deny SSH Access
<span><a href="#allow-and-deny-ssh-access">#</a></span>
</h4><p>You can specify which users are allowed to use SSH using:</p>
<pre><code>sudo nano /etc/ssh/sshd_config
</code></pre>
<p>Append to the end of the file</p>
<pre><code>AllowUsers alice bob
DenyUsers jane john
</code></pre>
<p>You can find all created users, which have a home directory:</p>
<pre><code>cat /etc/passwd | grep home
</code></pre>
<h4 id="using-key-based-authentication-only">Using key-based authentication only
<span><a href="#using-key-based-authentication-only">#</a></span>
</h4><p>Let&rsquo;s make one additional adjustment, so only key-based authentication are allowed.</p>
<pre><code>sudo nano /etc/ssh/sshd_config
</code></pre>
<p>Search and edit the following:</p>
<pre><code>ChallengeResponseAuthentication no
PasswordAuthentication no
UsePAM no
</code></pre>
<h2 id="uselful-additions">Uselful additions
<span><a href="#uselful-additions">#</a></span>
</h2><h3 id="speedtest">Speedtest
<span><a href="#speedtest">#</a></span>
</h3><pre><code>sudo apt-get install curl

curl -s https://install.speedtest.net/app/cli/install.deb.sh | sudo bash

sudo apt-get install speedtest
</code></pre>
<h3 id="iperf">iperf
<span><a href="#iperf">#</a></span>
</h3><pre><code>sudo apt-get install iperf3
</code></pre>
<h2 id="wireless-access-point">Wireless Access Point
<span><a href="#wireless-access-point">#</a></span>
</h2><p>If your WiFi is unreliable but you have access to an ethernet cable, you could try to set up a wireless access point with your Raspberry Pi!</p>
<p>You can read a great tutorial for setting up a Routed Wireless Access Point in the <a href="https://www.raspberrypi.com/documentation/computers/configuration.html#setting-up-a-routed-wireless-access-point">official documentation</a>.</p>
<p>open your hostapd:</p>
<pre><code>sudo nano /etc/hostapd/hostapd.conf
</code></pre>
<p>I used the following &ldquo;hostapd.conf&rdquo;:</p>
<pre><code>#ctrl_interface=/var/run/hostapd
#ctrl_interface_group=0
interface=wlan0
driver=nl80211

### IEEE 802.11
ssid=YOUR__SSID
wpa_passphrase=YOUR__PASSWORD
# a = 5 GHz, g = 2.4 GHz
hw_mode=a
# 36 or 149
channel=149
# 1=wpa, 2=wep, 3=both
auth_algs=1

### DFS
country_code=US
# allowed channels and transmit power levels based on the regulatory limits
ieee80211d=1
# enables radar detection and DFS support
ieee80211h=1

### IEEE 802.11n
ieee80211n=1
require_ht=1
ht_capab=[HT20][HT40+][SHORT-GI-20][SHORT-GI-40][DSSS_CCK-40]

### IEEE 802.11ac
ieee80211ac=1
# 0 = 20 or 40 MHz operating Channel width
# 1 = 80 MHz channel width
# 2 = 160 MHz channel width
# 3 = 80+80 MHz channel width
vht_oper_chwidth=1
# channel + 6 for 80 MHz
# 42 or 155
vht_oper_centr_freq_seg0_idx=155
vht_capab=[SHORT-GI-80][MAX-MPDU-3895][SU-BEAMFORMEE]

### IEEE 802.11i
wpa=2
wpa_key_mgmt=WPA-PSK
wpa_pairwise=CCMP
rsn_pairwise=CCMP

### WMM
wmm_enabled=1

uapsd_advertisement_enabled=1
macaddr_acl=0
ignore_broadcast_ssid=0
</code></pre>
<p>Hostapd need to be restarted after changing its config file.</p>
<pre><code>sudo systemctl stop hostapd.service
sudo systemctl start hostapd.service
sudo systemctl status hostapd.service
</code></pre>
<h3 id="finding-your-channel">Finding your channel
<span><a href="#finding-your-channel">#</a></span>
</h3><p>You can view possible channels with the following.</p>
<pre><code>iw list
</code></pre>
<p>Look at your current config</p>
<pre><code>iw dev
</code></pre>
<p>Depending on the chosen country, there are different frequencies possible. You can look on <a href="https://en.wikipedia.org/wiki/List_of_WLAN_channels#5_GHz_(802.11a/h/j/n/ac/ax)">wikipedia</a>.</p>
<pre><code>iw reg get
</code></pre>
<p>You can have a view at your routing with</p>
<pre><code>route
</code></pre>
<p>If you want to know what channels are busy in your environment, you need to install nmcli.</p>
<p>With this service, we get a list of available wifi networks.</p>
<pre><code>nmcli dev wifi
</code></pre>
<p>You can force a rescan:</p>
<pre><code>sudo nmcli dev wifi rescan
</code></pre>
<h4 id="installing--network-management-command-line-interface-nmcli">Installing  Network Management Command-Line Interface (nmcli)
<span><a href="#installing--network-management-command-line-interface-nmcli">#</a></span>
</h4><p>Let&rsquo;s install it.</p>
<pre><code>sudo apt-get install network-manager
</code></pre>
<p>Now, you can start the service.</p>
<pre><code>sudo systemctl start NetworkManager.service 
</code></pre>
<p>But make sure, that it is not enabled!</p>
<pre><code>sudo systemctl disable NetworkManager.service
</code></pre>
<h3 id="testing-the-connection">Testing the Connection
<span><a href="#testing-the-connection">#</a></span>
</h3><p>You can test the connection speed between your computer and the Pi using iPerf.</p>
<h4 id="preparing-the-raspberry-pi">Preparing the Raspberry Pi
<span><a href="#preparing-the-raspberry-pi">#</a></span>
</h4><p>If you don&rsquo;t know the IP address of your pi. Use the following on your Raspberry Pi.</p>
<pre><code>hostname -I
</code></pre>
<p>Let&rsquo;s start the server!</p>
<pre><code>iperf3 -s
</code></pre>
<h4 id="preparing-the-mac">Preparing the Mac
<span><a href="#preparing-the-mac">#</a></span>
</h4><p>Install iperf:</p>
<pre><code>brew install iperf3
</code></pre>
<p>Run your mac as client:</p>
<pre><code>iperf3 -c IP_ADDRESS
</code></pre>
<h4 id="results">Results
<span><a href="#results">#</a></span>
</h4><p>Now, you can see your network speed between your Mac and Raspberry Pi.</p>
<h3 id="testing-your-internet-with-speedtest">Testing your internet with speedtest
<span><a href="#testing-your-internet-with-speedtest">#</a></span>
</h3><p>You will find the official instruction <a href="https://www.speedtest.net/en/apps/cli">here</a></p>
<pre><code>sudo apt-get install curl

curl -s https://install.speedtest.net/app/cli/install.deb.sh | sudo bash

sudo apt-get install speedtest
</code></pre>
<h2 id="backing-up-the-sd-card">Backing up the SD Card
<span><a href="#backing-up-the-sd-card">#</a></span>
</h2><p>The most simple way to backup your Pi is coping all the files from the SD card. But creating an image is more reliable. You could store these files on your Mac or iCloud.</p>
<h3 id="creating-an-image-using-macos">Creating an image using macOS
<span><a href="#creating-an-image-using-macos">#</a></span>
</h3><p>Let&rsquo;s find the name of our SD card using</p>
<pre><code>diskutil list
</code></pre>
<p>Let&rsquo;s create the image.</p>
<pre><code>sudo dd if=/dev/rdisk# status=progress bs=1M | gzip -c &gt; PiBackup.dmg.gz
</code></pre>
<p>This takes a while and will save the image into your user directory. The whole SD-card is copied and afterwards compressed.</p>
<h3 id="restoring-the-image-using-macos">Restoring the image using macOS
<span><a href="#restoring-the-image-using-macos">#</a></span>
</h3><p>Before we can restore a backup, we need to unmount the SD card.</p>
<pre><code>diskutil unmountDisk /dev/disk#
</code></pre>
<p>Now, we can restore our backup image.</p>
<pre><code>sudo bash -c &quot;gzcat PiBackup.dmg.gz | dd of=/dev/disk# status=progress&quot;
</code></pre>
<h2 id="optional-overlay-file-system">Optional: Overlay File System
<span><a href="#optional-overlay-file-system">#</a></span>
</h2><p>Changes made are not permanently during Overlay File System is activated. Everything that was changed will not be available once the Pi rebooted. Also, you can make your boot partition read only. That should increase your reliability of the system. But don&rsquo;t forget to disable it before starting your next project!</p>
<p>You will find the setting here:</p>
<pre><code>sudo raspi-config
</code></pre>
<p>Go to &ldquo;Performance Options&rdquo; and &ldquo;Overlay File System&rdquo;.</p>
<h2 id="backup-speed-increase-on-a-mac">Backup Speed Increase on a Mac
<span><a href="#backup-speed-increase-on-a-mac">#</a></span>
</h2><pre><code>sudo sysctl debug.lowpri_throttle_enabled=0
</code></pre>
<h2 id="conclusion">Conclusion
<span><a href="#conclusion">#</a></span>
</h2><p>That were a few first useful configurations for your Raspberry Pi!</p>

        </div>
        

    


<div class="post-info">
    
        <div class="post-date dt-published">2022-04-10</div>
    

    <a class="post-hidden-url u-url" href="https://czyrnik.me/blog/how-to-configure-a-raspberry-pi/">https://czyrnik.me/blog/how-to-configure-a-raspberry-pi/</a>
    <a href="https://czyrnik.me" class="p-name p-author post-hidden-author h-card" rel="me">Toni Czyrnik</a>


    <div class="post-taxonomies">
        
            <ul class="post-categories">
                
                    
                    <li><a href="">Raspberry Pi</a></li>
                
                    
                    <li><a href="https://czyrnik.me/categories/coding/">Coding</a></li>
                
            </ul>
            
            
    </div>
</div>

    </article>

    
        
    <div class="pagination post-pagination">
        <div class="left pagination-item ">
            
                <a href="/blog/starting-a-life-as-digital-nomad/">Starting a Life as Digital Nomad</a>
            
        </div>
        <div class="right pagination-item ">
            
                <a href="/blog/how-to-use-a-raspberry-as-time-capsule/">How to use a Raspberry as Time Capsule</a>
            
        </div>
    </div>




    

    

    

    


        </main>
        
            <footer class="common-footer">
    
    

    <div class="common-footer-bottom">
        
        <div class="copyright">
            <p>© Toni Czyrnik, 2022<br>
            Powered by <a target="_blank" rel="noopener noreferrer" href="https://gohugo.io/">Hugo</a>, theme <a target="_blank" rel="noopener noreferrer" href="https://github.com/mitrichius/hugo-theme-anubis">Anubis</a>.<br>
            
            </p>  
        </div> 

        

    



    <button class="theme-switcher">
        Dark theme
    </button>

    <script>
    const STORAGE_KEY = 'user-color-scheme'
    const defaultTheme = "auto"

    let currentTheme
    let switchButton
    let autoDefinedScheme = window.matchMedia('(prefers-color-scheme: dark)')

    const autoChangeScheme = e => {
        currentTheme = e.matches ? 'dark' : 'light'
        document.documentElement.setAttribute('data-theme', currentTheme)
        changeButtonText()
    }

    document.addEventListener('DOMContentLoaded', function() {
        switchButton = document.querySelector('.theme-switcher')
        currentTheme = detectCurrentScheme()
        if (currentTheme == 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark')
        }
        if (currentTheme == 'auto') {
            autoChangeScheme(autoDefinedScheme);
            autoDefinedScheme.addListener(autoChangeScheme);
        }
        changeButtonText()
        switchButton.addEventListener('click', switchTheme, false)
    })

    function detectCurrentScheme() {
        if (localStorage.getItem(STORAGE_KEY)) {
            return localStorage.getItem(STORAGE_KEY)
        } 
        if (defaultTheme) {
            return defaultTheme
        } 
        if (!window.matchMedia) {
            return 'light'
        } 
        if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
            return 'dark'
        }
        return 'light'
    }

    function changeButtonText()
    {   
        switchButton.textContent = currentTheme == 'dark' ?  "Light theme" : "Dark theme"
    }

    function switchTheme(e) {
        if (currentTheme == 'dark') {
            localStorage.setItem(STORAGE_KEY, 'light')
            document.documentElement.setAttribute('data-theme', 'light')
            currentTheme = 'light'
        } else {
            localStorage.setItem(STORAGE_KEY, 'dark')
            document.documentElement.setAttribute('data-theme', 'dark')
            currentTheme = 'dark'
        }
        changeButtonText()
    }
    </script>
   
    </div>

    <p class="h-card vcard">

    <a href=https://czyrnik.me class="p-name u-url url fn" rel="me">Toni Czyrnik</a> 

    

    
</p> 
</footer>

        
    </div>
</body>
</html>
